apiVersion: batch/v1
kind: Job
metadata:
  name: uploadbot
  namespace: broker-<ENV>
spec:
  completions: 1
  parallelism: 1
  template:
    metadata:
      labels:
        app: uploadbot
    spec:
      restartPolicy: OnFailure
      containers:
        - name: uploadbot
          image: "node:16-buster"
          env:
            - name: COUNT
              value: "1000000000"
            - name: MIN_SIZE
              value: "1000"
            - name: MAX_SIZE
              value: "100000"
            - name: ENDPOINT
              value: "http://storage:8888"
            - name: SLEEP
              value: "2"
            - name: SEED_PHRASE
              value: "height unusual narrow dream follow grow rebel panda because then equip basic"
          command:
            - /bin/bash
            - -c
            - |
              set -x
              npm install -g near-cli
              wget -O bench.sh https://gist.githubusercontent.com/jsign/d32bc62d14c0069a924a9afc99337ba4/raw/aa59603917f4252cf2c73a0f063bab3d6a4cde1c/bench.sh
              chmod 755 bench.sh
              ./bench.sh $ENDPOINT $MIN_SIZE $MAX_SIZE $COUNT $SLEEP
